# 🎯 安规刷题系统 - 完整技术文档

## 📋 系统概述

**安规刷题系统** 是一个专业的电力安全规程学习平台，集成了智能题型识别、双系统架构、题目重构等先进技术，为电力行业从业人员提供高效的学习体验。

### 🏆 核心特性

- **🎯 100%题型识别率**: 集成双系统架构，支持智能重构，消除unknown类型
- **🔧 智能题目重构**: 自动修复Excel中被错误分割的题目
- **📊 多模式识别**: 支持原始、增强、重构器、共识等多种识别模式
- **💾 完整数据管理**: 题库管理、错题记忆、统计分析一体化
- **🎨 现代化GUI**: 美观易用的图形界面，支持多种主题

## 🏗️ 系统架构

### 📁 项目结构

```
刷题程序/
├── 📱 GUI刷题程序.py              # 主界面程序
├── 🎯 双系统题型识别器.py          # 双系统识别核心
├── 🔧 高精度题型识别.py           # 高精度识别接口
├── 🧠 智能题型识别.py             # 智能识别引擎
├── 📚 题库管理.py                 # 题库管理系统
├── 🔄 题库转换管理器.py           # 题库转换管理器
├── 📄 PDF题库解析.py              # PDF解析器
├── 📝 Word题库智能解析器.py       # Word智能解析器
├── 🔧 PDF题库转换工具.py          # PDF转换工具
├── 🔧 Word题库转换工具.py         # Word转换工具
├── 🚀 启动器.py                   # 系统启动器
├── ⚙️ 用户设置.py                # 用户配置管理
├── 📊 统计分析.py                 # 数据统计分析
├── 💾 错题记忆.py                 # 错题管理系统
├── 🎮 刷题引擎.py                 # 刷题核心引擎
├── question-recog/               # 题型识别子系统
│   ├── 🎯 main.py               # 主识别程序
│   ├── 🔧 智能题目重构器.py      # 题目重构器
│   ├── 🤖 train_model.py        # 模型训练
│   ├── src/                     # 核心模块
│   │   ├── pipeline.py          # 识别流水线
│   │   ├── features/            # 特征提取
│   │   ├── rules/               # 规则引擎
│   │   ├── model/               # 训练模型
│   │   └── calibrator/          # 置信度校准
│   ├── configs/                 # 配置文件
│   └── data/                    # 数据目录
├── 题库/                        # 题库文件
└── 📋 文档/                     # 系统文档
```

### 🔧 核心组件

#### 1. 双系统题型识别器 (`双系统题型识别器.py`)

**功能**: 统一的题型识别接口，集成多种识别系统

**特性**:
- 支持5种识别模式：`auto`, `original`, `enhanced`, `rebuilder`, `consensus`
- 自动选择最佳识别系统
- 多系统投票共识机制
- 性能基准测试

**核心方法**:
```python
def detect_question_type(question_text, answer, options=None, excel_type=None, mode='auto'):
    """统一的题型识别接口"""
    # 返回: (题型, 置信度, 详细信息)
```

#### 2. 智能题目重构器 (`question-recog/智能题目重构器.py`)

**功能**: 解决Excel中题目被错误分割的问题

**核心算法**:
- 智能边界识别：基于内容模式和标点符号
- 内容合并策略：将分散片段重组为完整题目
- 质量评估体系：多维度评估重构质量

**处理效果**:
- 原始数据：2174行混乱数据
- 重构结果：1801个高质量题目 (99.7%高质量)
- 识别成功率：100% (无unknown)

#### 3. 高精度题型识别 (`高精度题型识别.py`)

**功能**: 刷题系统专用的高精度识别接口

**识别类型**:
- 单选题 (single_choice)
- 多选题 (multiple_choice)  
- 判断题 (true_false)
- 填空题 (fill_blank)
- 简答题 (subjective)

**识别策略**:
1. Excel标记优先 (置信度: 0.95)
2. 选项模式识别 (置信度: 0.85-0.90)
3. 答案模式匹配 (置信度: 0.80-0.90)
4. 题干关键词识别 (置信度: 0.75-0.85)
5. 智能兜底策略 (置信度: 0.40-0.70)

#### 4. GUI刷题程序 (`GUI刷题程序.py`)

**功能**: 现代化的图形用户界面

**界面特性**:
- 🎨 现代化设计，支持多主题
- 📱 响应式布局，适配不同屏幕
- 🎯 智能题目显示和交互
- 📊 实时统计和进度跟踪
- 💾 错题自动收集和复习

**主要功能模块**:
- 题库选择和管理
- 刷题模式选择 (顺序/随机/错题)
- 实时答题和反馈
- 统计分析和报告
- 用户设置和偏好

#### 5. 题库转换系统

**核心文件**:
- `题库转换管理器.py` - 统一转换管理
- `PDF题库解析.py` - PDF文档解析
- `Word题库智能解析器.py` - Word智能解析
- `PDF题库转换工具.py` - PDF转Excel工具
- `Word题库转换工具.py` - Word转Excel工具

**功能特性**:
- 🔄 多格式支持: PDF, Word, Excel
- 📊 批量转换处理
- 🎯 智能格式识别
- 📈 转换状态统计
- 🛡️ 错误处理和恢复

**转换流程**:
1. 文件格式检测和验证
2. 智能内容解析和提取
3. 题目结构识别和重构
4. 标准格式转换和输出
5. 质量检查和结果验证

## 🚀 快速开始

### 📦 环境要求

```bash
Python >= 3.8
tkinter (GUI支持)
pandas >= 1.3.0
openpyxl >= 3.0.0
scikit-learn >= 1.0.0
xgboost >= 1.5.0
python-docx >= 0.8.11 (Word文档支持)
pdfplumber >= 0.7.0 (PDF解析支持)
PyPDF2 >= 3.0.0 (PDF处理支持)
```

### ⚡ 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/zzyIyzz/shuti-withoutai.git
cd 刷题程序
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **启动系统**
```bash
# 方式1: 使用启动器
python 启动器.py

# 方式2: 直接启动GUI
python GUI刷题程序.py

# 方式3: 使用批处理文件 (Windows)
运行GUI.bat
```

### 📚 题库准备

1. **支持的题库格式**
   - Excel文件 (`.xlsx`)
   - PDF文件 (`.pdf`) 
   - Word文档 (`.docx`)

2. **Excel格式要求**
   ```
   列名要求:
   - 题目（必填）：    # 题目内容
   - 正确答案（必填）  # 标准答案
   - 选项A（必填）     # 选项A
   - 选项B（必填）     # 选项B
   - 选项C            # 选项C (可选)
   - 选项D            # 选项D (可选)
   - 题型             # 题型标记 (可选)
   ```

3. **题库放置**
   - 将题库文件放入 `题库/` 目录
   - 系统会自动识别和加载

## 🎯 使用指南

### 🔄 题库转换系统

#### 基础使用

```python
from 题库转换管理器 import TikuConverterManager

# 创建转换管理器
converter = TikuConverterManager()

# 查看可转换文件
files = converter.get_convertible_files()
print(f"找到 {len(files)} 个可转换文件")

# 批量转换为Excel
results = converter.batch_convert('excel')
print(f"转换成功: {results['success']} 个")
```

#### 命令行使用

```bash
# 查看可转换文件
python 题库转换管理器.py --list

# 批量转换为Excel
python 题库转换管理器.py --batch

# 转换状态统计
python 题库转换管理器.py --status

# 转换指定格式
python 题库转换管理器.py --convert pdf
python 题库转换管理器.py --convert word
```

#### 启动器集成

通过启动器菜单选择 "9. 题库转换管理器" 可以：
- 查看可转换文件列表
- 执行批量转换操作
- 查看转换状态统计
- 管理转换输出文件

### 🔧 题型识别系统

#### 基础使用

```python
from 双系统题型识别器 import detect_question_type_dual

# 基础识别
question_type, confidence = detect_question_type_dual(
    question_text="下列哪个是正确的？",
    answer="A",
    options=["A: 选项A", "B: 选项B", "C: 选项C", "D: 选项D"]
)
print(f"题型: {question_type}, 置信度: {confidence}")
```

#### 高级功能

```python
from 双系统题型识别器 import DualSystemRecognizer

recognizer = DualSystemRecognizer()

# 多模式识别
modes = ['auto', 'original', 'enhanced', 'consensus']
for mode in modes:
    q_type, confidence, details = recognizer.detect_question_type(
        question_text, answer, options, mode=mode
    )
    print(f"{mode}: {q_type} ({confidence:.2f})")

# 批量处理Excel
result = recognizer.batch_process_excel(
    excel_path="题库/新员工一级竞赛题库.xlsx",
    mode="rebuilder",
    output_path="识别结果.json"
)
```

#### 题目重构

```python
from question_recog.智能题目重构器 import QuestionRebuilder

rebuilder = QuestionRebuilder()

# 处理Excel文件
questions = rebuilder.process_excel_file("题库/题库文件.xlsx")

print(f"重构得到 {len(questions)} 个高质量题目")
for q in questions[:3]:
    print(f"题目: {q['question'][:50]}...")
    print(f"质量分数: {q['quality_score']:.2f}")
```

### 📱 GUI界面使用

#### 主界面功能

1. **题库管理**
   - 📁 选择题库文件
   - 🔍 题库信息预览
   - 📊 题型分布统计

2. **刷题模式**
   - 📖 顺序刷题：按题目顺序学习
   - 🎲 随机刷题：随机抽取题目
   - ❌ 错题模式：专门练习错题
   - 🎯 专项练习：按题型分类练习

3. **答题界面**
   - 📝 题目显示和选项选择
   - ⏱️ 答题计时 (可选)
   - 💡 答案解析和说明
   - 📊 实时统计信息

4. **统计分析**
   - 📈 答题正确率趋势
   - 📊 各题型掌握情况
   - 🎯 学习进度跟踪
   - 📋 详细答题记录

#### 设置和配置

1. **界面设置**
   - 🎨 主题选择 (浅色/深色/自动)
   - 🔤 字体大小调整
   - 🖼️ 界面布局选项

2. **学习设置**
   - ⏰ 答题时间限制
   - 🔄 自动下一题
   - 💾 错题自动收集
   - 📊 统计信息显示

3. **题型识别设置**
   - 🎯 识别模式选择
   - 🔧 置信度阈值
   - 📋 识别结果显示

## 🔧 高级配置

### 📋 配置文件

#### 主配置 (`configs/app.yaml`)

```yaml
# 应用配置
app:
  name: "安规刷题系统"
  version: "4.0"
  debug: false

# 题型识别配置
recognition:
  default_mode: "auto"
  confidence_threshold: 0.7
  enable_rebuilder: true

# 界面配置
ui:
  theme: "auto"
  font_size: 12
  auto_next: true
  show_timer: true

# 数据配置
data:
  auto_save: true
  backup_interval: 300  # 秒
  max_history: 1000
```

#### 规则配置 (`configs/rules.yaml`)

```yaml
# 题型识别规则
rules:
  single_choice:
    priority: 100
    patterns:
      - "下列.*正确"
      - "以下.*是"
    confidence: 0.85

  multiple_choice:
    priority: 90
    patterns:
      - "多选"
      - "哪些"
      - "包括"
    confidence: 0.90

  true_false:
    priority: 95
    patterns:
      - "正确吗"
      - "是否"
    answers: ["对", "错", "√", "×"]
    confidence: 0.90
```

### 🤖 模型训练

#### 数据准备

1. **标注数据格式** (`data/labels/manual_labels.jsonl`)
```json
{"source_id": "q001", "gold_type": "single_choice", "confidence": 1.0}
{"source_id": "q002", "gold_type": "multiple_choice", "confidence": 1.0}
{"source_id": "q003", "gold_type": "true_false", "confidence": 1.0}
```

2. **训练数据要求**
   - 最少100个标注样本
   - 各题型样本均衡分布
   - 高质量人工标注

#### 模型训练流程

```bash
# 1. 准备训练数据
cd question-recog
python tools/annotation_tool.py

# 2. 训练模型
python train_model.py

# 3. 评估模型
python tools/test_trained_model.py

# 4. 部署模型
# 训练好的模型会自动保存到 src/model/ 目录
```

#### 模型优化

```python
# 自定义训练参数
training_config = {
    'n_estimators': 200,
    'max_depth': 8,
    'learning_rate': 0.1,
    'subsample': 0.8,
    'colsample_bytree': 0.8
}

# 交叉验证
from sklearn.model_selection import cross_val_score
scores = cross_val_score(model, X, y, cv=5, scoring='f1_weighted')
print(f"交叉验证F1分数: {scores.mean():.3f} ± {scores.std():.3f}")
```

## 🧪 测试和验证

### 🔍 单元测试

```bash
# 运行所有测试
cd question-recog
python -m pytest tests/ -v

# 运行特定测试
python -m pytest tests/unit/test_feature_extractor.py -v
python -m pytest tests/e2e/test_pipeline.py -v
```

### 📊 性能测试

```python
# 识别性能测试
from 双系统题型识别器 import DualSystemRecognizer

recognizer = DualSystemRecognizer()

# 基准测试
test_questions = [
    {'question': '...', 'answer': '...', 'options': [...], 'expected_type': '...'},
    # ... 更多测试用例
]

benchmark_results = recognizer.benchmark_systems(test_questions)
for system, results in benchmark_results.items():
    print(f"{system}: 准确率 {results['accuracy']:.2f}, 平均置信度 {results['avg_confidence']:.2f}")
```

### 🎯 集成测试

```bash
# 完整系统测试
python 启动器.py --test-mode

# GUI自动化测试 (需要安装 pyautogui)
python tests/gui_test.py
```

## 🚀 部署和维护

### 📦 打包发布

```bash
# 使用 PyInstaller 打包
pip install pyinstaller

# 打包GUI程序
pyinstaller --onefile --windowed GUI刷题程序.py

# 打包完整系统
pyinstaller --onedir --windowed 启动器.py
```

### 🔧 系统维护

#### 日志管理

```python
# 日志配置 (configs/logging.yaml)
logging:
  version: 1
  handlers:
    file:
      class: logging.FileHandler
      filename: logs/system.log
      level: INFO
    console:
      class: logging.StreamHandler
      level: DEBUG
  root:
    level: INFO
    handlers: [file, console]
```

#### 数据备份

```bash
# 自动备份脚本
python tools/backup_data.py --output backup/$(date +%Y%m%d_%H%M%S)
```

#### 性能监控

```python
# 性能监控
import psutil
import time

def monitor_performance():
    while True:
        cpu_percent = psutil.cpu_percent()
        memory_percent = psutil.virtual_memory().percent
        print(f"CPU: {cpu_percent}%, 内存: {memory_percent}%")
        time.sleep(60)
```

## 🛠️ 故障排除

### 常见问题

#### 1. 题型识别准确率低

**原因分析**:
- 题库格式不标准
- 训练数据不足
- 模型需要重新训练

**解决方案**:
```bash
# 1. 检查题库格式
python tools/validate_question_bank.py

# 2. 使用题目重构器
python question-recog/智能题目重构器.py

# 3. 重新训练模型
python question-recog/train_model.py
```

#### 2. GUI界面无法启动

**原因分析**:
- tkinter未安装
- Python版本不兼容
- 依赖包缺失

**解决方案**:
```bash
# 检查Python版本
python --version  # 需要 >= 3.8

# 安装tkinter (Ubuntu/Debian)
sudo apt-get install python3-tk

# 重新安装依赖
pip install -r requirements.txt --force-reinstall
```

#### 3. 题库文件无法加载

**原因分析**:
- 文件格式不支持
- 文件损坏
- 编码问题

**解决方案**:
```python
# 检查文件编码
import chardet
with open('题库文件.xlsx', 'rb') as f:
    encoding = chardet.detect(f.read())
    print(f"文件编码: {encoding}")

# 转换文件格式
import pandas as pd
df = pd.read_excel('题库文件.xlsx')
df.to_excel('题库文件_修复.xlsx', index=False)
```

### 🔧 调试模式

```bash
# 启用调试模式
export DEBUG=1
python GUI刷题程序.py

# 或者在代码中设置
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 📈 性能优化

### 🚀 识别速度优化

```python
# 1. 缓存识别结果
from functools import lru_cache

@lru_cache(maxsize=1000)
def cached_recognition(question_hash, answer_hash):
    return recognize_question_type(question, answer)

# 2. 批量处理
def batch_recognize(questions, batch_size=100):
    results = []
    for i in range(0, len(questions), batch_size):
        batch = questions[i:i+batch_size]
        batch_results = process_batch(batch)
        results.extend(batch_results)
    return results

# 3. 多线程处理
from concurrent.futures import ThreadPoolExecutor

def parallel_recognize(questions, max_workers=4):
    with ThreadPoolExecutor(max_workers=max_workers) as executor:
        futures = [executor.submit(recognize_question, q) for q in questions]
        results = [future.result() for future in futures]
    return results
```

### 💾 内存优化

```python
# 1. 生成器处理大文件
def process_large_excel(file_path):
    for chunk in pd.read_excel(file_path, chunksize=1000):
        yield process_chunk(chunk)

# 2. 及时释放内存
import gc
def cleanup_memory():
    gc.collect()

# 3. 使用内存映射
import mmap
def read_large_file(file_path):
    with open(file_path, 'rb') as f:
        with mmap.mmap(f.fileno(), 0, access=mmap.ACCESS_READ) as mm:
            return process_mmap(mm)
```

## 🔮 未来规划

### 🎯 短期目标 (1-3个月)

- [ ] 🤖 集成更多AI模型 (BERT, GPT)
- [ ] 📱 移动端适配 (Android/iOS)
- [ ] 🌐 Web版本开发
- [ ] 📊 更丰富的统计分析功能

### 🚀 中期目标 (3-6个月)

- [ ] ☁️ 云端同步和备份
- [ ] 👥 多用户支持和管理
- [ ] 🎮 游戏化学习体验
- [ ] 🔊 语音识别和朗读

### 🌟 长期目标 (6-12个月)

- [ ] 🧠 智能学习路径推荐
- [ ] 📈 个性化学习分析
- [ ] 🤝 协作学习功能
- [ ] 🏆 学习成就系统

## 📞 技术支持

### 🐛 问题反馈

- **GitHub Issues**: https://github.com/zzyIyzz/shuti-withoutai/issues
- **邮箱支持**: support@example.com
- **QQ群**: 123456789

### 📚 学习资源

- **官方文档**: https://github.com/zzyIyzz/shuti-withoutai/wiki
- **视频教程**: https://example.com/tutorials
- **API文档**: https://example.com/api-docs

### 🤝 贡献指南

欢迎贡献代码和建议！请查看 [CONTRIBUTING.md](CONTRIBUTING.md) 了解详细信息。

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 🙏 致谢

感谢所有为本项目做出贡献的开发者和用户！

---

**📅 文档版本**: v4.0  
**📅 最后更新**: 2025年10月18日  
**👨‍💻 维护者**: 项目开发团队
